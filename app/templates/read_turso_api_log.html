{% extends "base.html" %} {% block title %}Dashboard{% endblock %} {% block
content %}

<h2>システム実行トレースログ</h2>

<form method="get" class="row g-3 mb-4">
  <div class="col-auto">
    <input
      type="date"
      name="start_date"
      class="form-control"
      value="{{ start_date }}"
    />
  </div>
  <div class="col-auto">
    <input
      type="date"
      name="end_date"
      class="form-control"
      value="{{ end_date }}"
    />
  </div>
  <div class="col-auto">
    <button type="submit" class="btn btn-primary">検索</button>
  </div>
</form>

{% if error %}
<div class="alert alert-danger">{{ error }}</div>
{% endif %}

<table class="table table-striped table-hover">
  <thead class="table-dark">
    <tr>
      <th>実行日時(API)</th>
      <th>Method</th>
      <th>Endpoint</th>
      <th>Task / Step</th>
      <th>Status</th>
      <th>IP</th>
    </tr>
  </thead>
  <tbody>
    {% for log in logs %}
    <tr>
      <td>{{ log.api_created_at }}</td>
      <td><span class="badge bg-info text-dark">{{ log.method }}</span></td>
      <td>{{ log.endpoint }}</td>
      <td>
        {{ log.task_name }}<br /><small class="text-muted"
          >{{ log.step_name }}</small
        >
      </td>
      <td>
        <span
          class="badge {% if log.status == 'SUCCESS' %}bg-success{% elif log.status == 'FAILED' %}bg-danger{% else %}bg-warning text-dark{% endif %}"
        >
          {{ log.status }}
        </span>
      </td>
      <td>{{ log.ip_address }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<hr />

{% endblock %}
